<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro 简历生成器</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 React DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 引入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 引入 Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600&family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&family=Merriweather:wght@300;400;700&family=Open+Sans:wght@300;400;600&family=Playfair+Display:wght@400;600;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <style>
        /* 自定义滚动条 */
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600&family=Oswald:wght@300;400;500;600&display=swap');

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* 打印样式优化 - 确保打印与预览一致 */
        @page {
            size: A4;
            margin: 15mm;
        }

        @media print {

            /* 隐藏所有非简历内容 */
            body>*:not(#root) {
                display: none !important;
            }

            html,
            body {
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            #root {
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
            }

            /* 隐藏侧边栏和其他UI */
            .print\\:hidden {
                display: none !important;
                width: 0 !important;
                height: 0 !important;
                overflow: hidden !important;
                position: absolute !important;
                left: -9999px !important;
            }

            .print\\:block {
                display: block !important;
            }

            .print\\:shadow-none {
                box-shadow: none !important;
            }

            /* 预览区域容器 */
            .bg-gray-200.flex-1 {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                display: block !important;
                width: 100% !important;
            }

            .print\\:h-auto {
                height: auto !important;
                min-height: auto !important;
            }

            /* 隐藏滚动条 */
            ::-webkit-scrollbar {
                display: none;
            }
        }
    </style>
</head>

<body class="bg-gray-100 font-sans text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        // --- 图标组件 (SVG) ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const UserIcon = ({ className }) => <Icon className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></Icon>;
        const MailIcon = ({ className }) => <Icon className={className}><rect width="20" height="16" x="2" y="4" rx="2" /><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" /></Icon>;
        const PhoneIcon = ({ className }) => <Icon className={className}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" /></Icon>;
        const MapPinIcon = ({ className }) => <Icon className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></Icon>;
        const LinkedinIcon = ({ className }) => <Icon className={className}><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" /><rect width="4" height="12" x="2" y="9" /><circle cx="4" cy="4" r="2" /></Icon>;
        const GlobeIcon = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10" /><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" /><path d="M2 12h20" /></Icon>;
        const PlusIcon = ({ className }) => <Icon className={className}><path d="M5 12h14" /><path d="M12 5v14" /></Icon>;
        const Trash2Icon = ({ className }) => <Icon className={className}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></Icon>;
        const Wand2Icon = ({ className }) => <Icon className={className}><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z" /><path d="m14 7 3 3" /><path d="M5 6v4" /><path d="M19 14v4" /><path d="M10 2v2" /><path d="M7 8H3" /><path d="M21 16h-4" /><path d="M11 3H9" /></Icon>;
        const RotateCcwIcon = ({ className }) => <Icon className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></Icon>;
        const PrinterIcon = ({ className }) => <Icon className={className}><path d="M6 9V2h12v7" /><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" /><path d="M6 14h12v8H6z" /></Icon>;
        const LayoutIcon = ({ className }) => <Icon className={className}><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><line x1="9" x2="9" y1="3" y2="21" /></Icon>;
        const TypeIcon = ({ className }) => <Icon className={className}><path d="M4 7V4h16v3" /><path d="M9 20h6" /><path d="M12 4v16" /></Icon>;
        const ChevronDownIcon = ({ className }) => <Icon className={className}><path d="m6 9 6 6 6-6" /></Icon>;
        const FileTextIcon = ({ className }) => <Icon className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /></Icon>;
        const BriefcaseIcon = ({ className }) => <Icon className={className}><rect width="20" height="14" x="2" y="7" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></Icon>;
        const GraduationCapIcon = ({ className }) => <Icon className={className}><path d="M22 10v6M2 10l10-5 10 5-10 5z" /><path d="M6 12v5c3 3 9 3 12 0v-5" /></Icon>;
        const RocketIcon = ({ className }) => <Icon className={className}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z" /><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z" /><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0" /><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5" /></Icon>;
        const UploadIcon = ({ className }) => <Icon className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" x2="12" y1="3" y2="15" /></Icon>;
        const XIcon = ({ className }) => <Icon className={className}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></Icon>;
        const ArrowUpIcon = ({ className }) => <Icon className={className}><path d="m18 15-6-6-6 6" /></Icon>;
        const ArrowDownIcon = ({ className }) => <Icon className={className}><path d="m6 9 6 6 6-6" /></Icon>;
        const AlertCircleIcon = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></Icon>;
        const PaletteIcon = ({ className }) => <Icon className={className}><circle cx="13.5" cy="6.5" r=".5" fill="currentColor" /><circle cx="17.5" cy="10.5" r=".5" fill="currentColor" /><circle cx="8.5" cy="7.5" r=".5" fill="currentColor" /><circle cx="6.5" cy="12.5" r=".5" fill="currentColor" /><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.6 0 1-.4 1-1 0-.6-.4-1-1-1-1.5 0-3-1.5-3-3 0-1.1.9-2 2-2h1c3.9 0 7-3.1 7-7 0-3.9-3.1-7-7-7z" /></Icon>;

        // --- 数据结构与初始值 ---
        const { useState, useEffect, useRef, useLayoutEffect } = React;

        const initialData = {
            personal: {
                fullName: '',
                role: '',
                email: '',
                phone: '',
                address: '',
                linkedin: '',
                website: '',
                summary: '',
                avatar: ''
            },
            experience: [],
            education: [],
            projects: [],
            skills: [],
            languages: []
        };

        const exampleDataZh = {
            personal: {
                fullName: '张伟',
                role: '高级前端工程师',
                email: 'zhang.wei@example.com',
                phone: '138-0000-0000',
                address: '北京市朝阳区',
                linkedin: 'linkedin.com/in/zhangwei',
                website: 'zhangwei.design',
                summary: '拥有6年前端开发经验的资深工程师，专注于构建高性能、可扩展的Web应用。精通React生态系统，对用户体验和代码质量有执着追求。具有丰富的团队领导和技术架构设计经验。'
            },
            experience: [
                {
                    id: 11,
                    role: '高级前端开发工程师',
                    company: '未来科技有限公司',
                    date: '2021.03 - 至今',
                    location: '北京',
                    description: '• 负责公司核心SaaS产品的重构，使用React和TypeScript，将首屏加载时间减少40%。\n• 设计并实现通用的UI组件库，被公司内部5个项目复用，提升开发效率30%。\n• 带领5人团队进行技术攻坚，成功解决了复杂的数据可视化性能瓶颈。'
                },
                {
                    id: 12,
                    role: '前端开发工程师',
                    company: '知行互联网',
                    date: '2018.06 - 2021.02',
                    location: '上海',
                    description: '• 参与电商后台管理系统的开发，负责订单管理和用户中心模块。\n• 引入Redux进行状态管理，规范了数据流向，降低了Bug率。\n• 与后端团队紧密配合，设计并优化了RESTful API接口。'
                },
                {
                    id: 13,
                    role: '早期实习生',
                    company: '创新工场',
                    date: '2017.06 - 2017.09',
                    location: '北京',
                    description: '• 协助移动端页面的适配工作，学习了React Native基础。\n• 参与编写自动化测试脚本，提高了回归测试的覆盖率。'
                },
                {
                    id: 14,
                    role: '开源贡献者',
                    company: 'GitHub社区',
                    date: '2016 - 至今',
                    location: '远程',
                    description: '• 长期维护两个受欢迎的React组件库，总Star数超过2k。\n• 积极参与社区讨论，翻译了多篇高质量的前端技术文章。'
                },
                {
                    id: 15,
                    role: '校园技术合伙人',
                    company: '校园创业项目',
                    date: '2015.09 - 2016.06',
                    location: '上海',
                    description: '• 负责校园外卖平台的Web端开发，从0到1构建了MVP版本。\n• 使用Vue.js 1.0 版本进行开发，探索了早期的前端工程化实践。'
                }
            ],
            education: [
                {
                    id: 21,
                    degree: '计算机科学与技术 学士',
                    school: '上海交通大学',
                    date: '2014.09 - 2018.06',
                    location: '上海',
                    description: '主修课程：数据结构、算法分析、操作系统、计算机网络。在校期间多次获得奖学金。'
                }
            ],
            projects: [
                {
                    id: 31,
                    name: 'E-Shop 电商平台',
                    role: '核心开发者',
                    description: '基于Next.js的全栈电商平台，支持服务端渲染(SSR)。实现了购物车、支付集成和用户评价系统。',
                    link: 'github.com/zhangwei/eshop'
                },
                { id: 1, name: '电商后台管理系统', description: '基于 React + Ant Design 开发的后台管理系统... \n- 实现了动态权限路由\n- 优化了长列表渲染性能', link: 'github.com/zhangwei/admin' }
            ],
            skills: [
                { id: 1, name: '前端基础', items: 'HTML5, CSS3, JavaScript (ES6+)' },
                { id: 2, name: '框架/库', items: 'React, Vue, TypeScript, Tailwind CSS' },
                { id: 3, name: '工具', items: 'Git, Webpack, Vite, Jest' }
            ],
            languages: [
                { id: 1, language: '中文', proficiency: '母语' },
                { id: 2, language: '英语', proficiency: 'CET-6 / 流利' }
            ]
        };

        const exampleDataEn = {
            personal: {
                fullName: 'Alex Chen',
                role: 'Senior Frontend Engineer',
                email: 'alex.chen@example.com',
                phone: '+86 138-0000-0000',
                address: 'Beijing, China',
                linkedin: 'linkedin.com/in/alexc',
                website: 'alex.dev',
                summary: 'Passionate Senior Frontend Engineer with 6+ years of experience building high-performance web applications. Expert in React ecosystem and UI/UX best practices. Proven track record of technical leadership and architectural design.'
            },
            experience: [
                {
                    id: 11,
                    role: 'Senior Frontend Engineer',
                    company: 'Future Tech Inc.',
                    date: 'Mar 2021 - Present',
                    location: 'Beijing',
                    description: '• Led the architectural migration of the core SaaS platform using React & TypeScript, improving load time by 40%.\n• Developed a shared UI component library used across 5 internal products, boosting development efficiency by 30%.\n• Mentored a team of 5 junior developers and conducted code reviews to ensure high code quality.'
                },
                {
                    id: 12,
                    role: 'Frontend Developer',
                    company: 'Zhixing Internet',
                    date: 'Jun 2018 - Feb 2021',
                    location: 'Shanghai',
                    description: '• Developed key features for the e-commerce admin dashboard, focusing on order management and user settings.\n• Implemented Redux for state management, significantly reducing state-related bugs.\n• Collaborated closely with backend engineers to design and optimize RESTful APIs.'
                }
            ],
            education: [
                {
                    id: 21,
                    degree: 'B.S. in Computer Science',
                    school: 'Shanghai Jiao Tong University',
                    date: 'Sep 2014 - Jun 2018',
                    location: 'Shanghai',
                    description: 'Relevant Coursework: Data Structures, Algorithms, Operating Systems. Awarded University Scholarship 3 consecutive years.'
                }
            ],
            projects: [
                {
                    id: 31,
                    name: 'E-Shop Platform',
                    role: 'Core Developer',
                    description: 'A full-stack e-commerce platform built with Next.js, featuring SSR, cart management, and payment gateway integration.',
                    link: 'github.com/alexchen/eshop'
                },
                { id: 1, name: 'Admin Dashboard', description: 'Developed an admin dashboard using React + Ant Design. Implemented dynamic routing and optimized rendering performance for large lists.', link: 'github.com/alexchen/admin' }
            ],
            skills: [
                { id: 1, name: 'Frontend Fundamentals', items: 'HTML5, CSS3, JavaScript (ES6+)' },
                { id: 2, name: 'Frameworks/Libraries', items: 'React, Vue, TypeScript, Tailwind CSS' },
                { id: 3, name: 'Tools', items: 'Git, Webpack, Vite, Jest' }
            ],
            languages: [
                { id: 1, language: 'Chinese', proficiency: 'Native' },
                { id: 2, language: 'English', proficiency: 'Fluent' }
            ]
        };

        const uiText = {
            zh: {
                title: 'Pro 简历生成器',
                reset: '重置',
                example: '示例',
                fontLabel: '字体',
                themeLabel: '布局风格',
                themeLabel: '布局风格',
                themes: { classic: '经典', modern: '侧边栏', minimal: '极简', professional: '商务 (Professional)', elegant: '雅致 (Elegant)' },
                fonts: { default: '默认', sans: '无衬线 (Sans)', serif: '衬线 (Serif)', mono: '等宽 (Mono)', oswald: 'Oswald', lato: 'Lato' },
                colors: { default: '默认蓝', emerald: '翡翠绿', purple: '紫色', rose: '玫瑰红', amber: '琥珀色', slate: '深灰' },
                personalInfo: '个人信息',
                appearance: '外观设置',
                customColor: '自定义颜色',
                uploadLogo: '上传 Logo',
                removeLogo: '移除 Logo',
                logoPosition: 'Logo 位置',
                logoSize: 'Logo 大小',
                logoOpacity: 'Logo 透明度',
                logoPositions: { 'header-left': '页眉左侧', 'header-right': '页眉右侧', 'footer-left': '页脚左侧', 'footer-right': '页脚右侧', 'watermark-center': '全屏水印/居中' },
                uploadPhoto: '上传照片',
                removePhoto: '移除照片',
                experience: '工作经历',
                education: '教育背景',
                projects: '项目经历',
                skills: '技能清单',
                languages: '语言能力',
                export: '导出 PDF',
                export: '导出 PDF',
                add: '添加',
                contentTab: '内容编辑',
                designTab: '外观设计',
                labels: {
                    fullName: '姓名', role: '目标职位/头衔', email: '邮箱', phone: '电话',
                    address: '地址', linkedin: 'LinkedIn', website: '个人网站', summary: '个人简介',
                    company: '公司/组织', school: '学校/机构', degree: '学位/专业', date: '时间段',
                    location: '地点', description: '描述', name: '项目/分类名称', link: '链接', items: '技能项',
                    language: '语言', proficiency: '熟练度', employmentType: '类型', technologies: '技术栈'
                },
                placeholders: {
                    summary: '用一小段话简述你的职业目标和核心优势...',
                    description: '使用列表形式描述你的主要职责和成就...',
                    technologies: '例如：React, Node.js, AWS (逗号分隔)',
                    language: '例如：英语',
                    language: '例如：英语',
                    proficiency: '例如：流利 / CET-6 / Native',
                    employmentType: '性质'
                },
                languageOptions: [
                    '中文 (普通话)', '英语 (English)', '日语 (Japanese)', '韩语 (Korean)',
                    '法语 (French)', '德语 (German)', '西班牙语 (Spanish)', '俄语 (Russian)', '芬兰语 (Finnish)',
                    '意大利语 (Italian)', '葡萄牙语 (Portuguese)', '阿拉伯语 (Arabic)', '其他'
                ],
                proficiencyOptions: [
                    '母语 (Native)',
                    '流利 (Fluent)',
                    '熟练 (Proficient)',
                    '中级 (Intermediate)',
                    '入门 (Basic)'
                ],
                degreeOptions: [
                    '高中 (High School)', '大专 (Associate)', '学士学位 (Bachelor)', '硕士学位 (Master)', '博士学位 (PhD)', 'MBA', '其他'
                ],
                employmentTypes: [
                    '全职 (Full-time)', '兼职 (Part-time)', '实习 (Internship)', '合同工 (Contract)', '自由职业 (Freelance)'
                ]
            },
            en: {
                title: 'Pro Resume Builder',
                reset: 'Reset',
                example: 'Example',
                fontLabel: 'Font',
                themeLabel: 'Layout',
                themeLabel: 'Layout',
                themeLabel: 'Layout',
                themes: { classic: 'Classic', modern: 'Sidebar', minimal: 'Minimal', professional: 'Professional', elegant: 'Elegant' },
                fonts: { default: 'Default', sans: 'Sans Serif', serif: 'Serif', mono: 'Monospace', oswald: 'Oswald', lato: 'Lato' },
                colors: { default: 'Blue (Def)', emerald: 'Emerald', purple: 'Purple', rose: 'Rose', amber: 'Amber', slate: 'Slate' },
                personalInfo: 'Personal Info',
                appearance: 'Appearance',
                customColor: 'Custom Color',
                uploadLogo: 'Upload Logo',
                removeLogo: 'Remove Logo',
                logoPosition: 'Logo Position',
                logoSize: 'Logo Size',
                logoOpacity: 'Logo Opacity',
                logoPositions: { 'header-left': 'Header Left', 'header-right': 'Header Right', 'footer-left': 'Footer Left', 'footer-right': 'Footer Right', 'watermark-center': 'Watermark Center' },
                uploadPhoto: 'Upload Photo',
                removePhoto: 'Remove Photo',
                experience: 'Experience',
                education: 'Education',
                projects: 'Projects',
                skills: 'Skills',
                languages: 'Languages',
                export: 'Export PDF',
                export: 'Export PDF',
                add: 'Add',
                contentTab: 'Content',
                designTab: 'Design',
                labels: {
                    fullName: 'Full Name', role: 'Title / Job Target', email: 'Email', phone: 'Phone',
                    address: 'Location', linkedin: 'LinkedIn', website: 'Website', summary: 'Summary',
                    company: 'Company', school: 'University', degree: 'Degree', date: 'Date Range',
                    location: 'Location', description: 'Description', name: 'Name', link: 'Link', items: 'Items',
                    language: 'Language', proficiency: 'Proficiency', employmentType: 'Type', technologies: 'Technologies'
                },
                placeholders: {
                    summary: 'Briefly describe your career goals and key strengths...',
                    description: 'Describe your responsibilities and achievements in bullet points...',
                    technologies: 'e.g. React, Node.js, AWS',
                    language: 'e.g. English',
                    language: 'e.g. English',
                    proficiency: 'e.g. Fluent / Native / C1',
                    employmentType: 'Type'
                },
                languageOptions: [
                    'English', 'Chinese (Mandarin)', 'Japanese', 'Korean',
                    'French', 'German', 'Spanish', 'Russian', 'Finnish',
                    'Italian', 'Portuguese', 'Arabic', 'Other'
                ],
                proficiencyOptions: [
                    'Native',
                    'Fluent',
                    'Proficient',
                    'Intermediate',
                    'Basic'
                ],
                degreeOptions: [
                    'High School Diploma', 'Associate Degree', "Bachelor's Degree", "Master's Degree", 'Doctoral Degree (PhD)', 'MBA', 'Other'
                ],
                employmentTypes: [
                    'Full-time', 'Part-time', 'Internship', 'Contract', 'Freelance'
                ]
            }
        };



        // Helper: Date Picker Component (Year/Month)
        const DatePicker = ({ value, onChange }) => {
            const [isCurrent, setIsCurrent] = useState(false);
            const [start, setStart] = useState('');
            const [end, setEnd] = useState('');

            // Parse initial value
            useEffect(() => {
                const val = value || '';
                if (val.includes('Present') || val.includes('至今')) {
                    setIsCurrent(true);
                    const parts = val.split(/ - /);
                    if (parts[0]) setStart(parts[0]);
                } else if (val.includes(' - ')) {
                    const parts = val.split(' - ');
                    setStart(parts[0] || '');
                    setEnd(parts[1] || '');
                    setIsCurrent(false);
                } else {
                    setStart(val);
                    setIsCurrent(false);
                }
            }, []);

            // Handle changes
            const updateValue = (newStart, newEnd, newIsCurrent) => {
                let val = newStart || '';
                if (newStart && (newEnd || newIsCurrent)) val += ' - ';

                if (newIsCurrent) {
                    val += (window.lang === 'zh' ? '至今' : 'Present');
                } else if (newEnd) {
                    val += newEnd;
                }
                // Emit synthetic event for compatibility
                onChange({ target: { value: val } });
            };

            const handleStartChange = (e) => {
                const val = e.target.value;
                setStart(val);
                updateValue(val, end, isCurrent);
            };

            const handleEndChange = (e) => {
                const val = e.target.value;
                setEnd(val);
                updateValue(start, val, isCurrent);
            };

            const toggleCurrent = (e) => {
                const checked = e.target.checked;
                setIsCurrent(checked);
                updateValue(start, end, checked);
            };

            return (
                <div className="flex gap-2 items-center">
                    <input
                        type="month"
                        value={start}
                        onChange={handleStartChange}
                        className="flex-1 p-2 border border-gray-200 rounded text-sm min-w-0"
                        placeholder="Start"
                    />
                    <span className="text-gray-400 font-bold">-</span>
                    {isCurrent ? (
                        <div className="flex-1 p-2 bg-green-50 text-green-700 border border-green-200 rounded text-sm text-center font-medium cursor-not-allowed select-none">
                            {window.lang === 'zh' ? '至今' : 'Present'}
                        </div>
                    ) : (
                        <input
                            type="month"
                            value={end}
                            onChange={handleEndChange}
                            className="flex-1 p-2 border border-gray-200 rounded text-sm min-w-0"
                            placeholder="End"
                        />
                    )}
                    <div className="flex items-center gap-1 shrink-0">
                        <input
                            type="checkbox"
                            checked={isCurrent}
                            onChange={toggleCurrent}
                            className="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                        />
                        <label className="text-xs text-slate-500 whitespace-nowrap cursor-pointer select-none" onClick={() => toggleCurrent({ target: { checked: !isCurrent } })}>
                            {window.lang === 'zh' ? '至今' : 'Current'}
                        </label>
                    </div>
                </div>
            );
        };

        const SelectGroup = ({ label, value, onChange, options, showLabel = true }) => (
            <div className={showLabel ? "mb-3" : ""}>
                {showLabel && <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">{label}</label>}
                <div className="relative">
                    <select
                        value={value}
                        onChange={onChange}
                        className="w-full p-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-sm appearance-none cursor-pointer"
                    >
                        <option value="" disabled className="text-gray-400">Select {label}</option>
                        {options.map((opt, i) => (
                            <option key={i} value={opt.value || opt.label || opt}>{opt.label || opt}</option>
                        ))}
                    </select>
                    <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                        <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" /></svg>
                    </div>
                </div>
            </div>
        );

        const InputGroup = ({ label, name, value, onChange, placeholder, type = 'text', options = [] }) => {
            const listId = `list-${label}-${Math.random().toString(36).substr(2, 9)}`;
            return (
                <div className="mb-3">
                    <label className="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">{label}</label>
                    {type === 'textarea' ? (
                        <textarea
                            name={name}
                            value={value}
                            onChange={onChange}
                            placeholder={placeholder}
                            className="w-full p-2 border border-gray-200 rounded text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all h-24  resize-y"
                        />
                    ) : type === 'select' ? (
                        <SelectGroup label={label} name={name} value={value} onChange={onChange} options={options} showLabel={false} />
                    ) : type === 'date-range' ? (
                        <DatePicker value={value} onChange={onChange} />
                    ) : (
                        <>
                            <input
                                type={type}
                                name={name}
                                value={value}
                                onChange={onChange}
                                placeholder={placeholder}
                                list={options.length > 0 ? listId : undefined}
                                className="w-full p-2 border border-gray-200 rounded text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all"
                            />
                            {options.length > 0 && (
                                <datalist id={listId}>
                                    {options.map((opt, i) => (
                                        <option key={i} value={opt.value || opt.label || opt} />
                                    ))}
                                </datalist>
                            )}
                        </>
                    )}
                </div>
            );
        };

        // --- 动态列表组件 (Exp, Edu, etc.) ---
        const DynamicList = ({ title, items, icon: IconComp, onAdd, onRemove, onChange, onMove, fields, t }) => {
            const [isExpanded, setIsExpanded] = useState(true);

            return (
                <section className="bg-white p-5 rounded-xl shadow-sm border border-gray-200 transition-all hover:shadow-md">
                    <div className="flex items-center justify-between mb-4 cursor-pointer" onClick={() => setIsExpanded(!isExpanded)}>
                        <h2 className="flex items-center gap-2 text-lg font-bold text-slate-800">
                            <span className="text-blue-600"><IconComp /></span> {title}
                        </h2>
                        <span className={`text-gray-400 transition-transform ${isExpanded ? '' : '-rotate-90'}`}>
                            <ChevronDownIcon />
                        </span>
                    </div>

                    {isExpanded && (
                        <div className="space-y-6">
                            {items.map((item, index) => (
                                <div key={item.id} className="relative pl-4 border-l-2 border-gray-100 group hover:border-blue-200 transition-colors">
                                    <div className="absolute right-0 top-0 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity p-1 bg-white/80 backdrop-blur-sm rounded z-10">
                                        <button
                                            onClick={() => onMove && onMove(index, -1)}
                                            disabled={index === 0}
                                            className="p-1 text-gray-400 hover:text-blue-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
                                            title="Move Up"
                                        >
                                            <ArrowUpIcon className="w-4 h-4" />
                                        </button>
                                        <button
                                            onClick={() => onMove && onMove(index, 1)}
                                            disabled={index === items.length - 1}
                                            className="p-1 text-gray-400 hover:text-blue-600 disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
                                            title="Move Down"
                                        >
                                            <ArrowDownIcon className="w-4 h-4" />
                                        </button>
                                        <div className="w-px h-4 bg-gray-200 mx-1"></div>
                                        <button
                                            onClick={() => onRemove(item.id)}
                                            className="p-1 text-gray-400 hover:text-red-500 transition-colors"
                                            title="Remove"
                                        >
                                            <Trash2Icon className="w-4 h-4" />
                                        </button>
                                    </div>

                                    <div className="grid grid-cols-2 gap-3 mb-2">
                                        {fields.map((field) => (
                                            <div key={field.key} className={field.fullWidth ? "col-span-2" : "col-span-1"}>
                                                <InputGroup
                                                    label={t.labels[field.labelKey]}
                                                    value={item[field.key]}
                                                    onChange={(e) => onChange(item.id, field.key, e.target.value)}
                                                    placeholder={t.placeholders[field.placeholderKey] || t.placeholders[field.labelKey]}
                                                    type={field.type || (['description', 'items'].includes(field.key) ? 'textarea' : 'text')}
                                                    options={field.options}
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                            <button
                                onClick={onAdd}
                                className="w-full py-2 flex items-center justify-center gap-2 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors border border-blue-200 dashed"
                            >
                                <PlusIcon className="w-4 h-4" /> {t.add}
                            </button>
                        </div>
                    )}
                </section>
            );
        };

        // --- 主题布局组件 ---

        // Helper: Markdown-like Bullet points rendering
        const TextWithBullets = ({ text, className }) => {
            if (!text) return null;
            const lines = text.split('\n');
            return (
                <div className={className}>
                    {lines.map((line, i) => {
                        const trimmed = line.trim();
                        const isBullet = /^[-*•]/.test(trimmed);
                        if (isBullet) {
                            const content = trimmed.replace(/^[-*•]\s*/, '');
                            return (
                                <div key={i} className="flex items-start mb-0.5">
                                    <span className="mr-2 leading-[1.5em]">•</span>
                                    <span className="flex-1 leading-[1.5em]">{content}</span>
                                </div>
                            );
                        }
                        return (
                            <p key={i} className="mb-0.5 min-h-[1.2em] leading-[1.5em]">
                                {line}
                            </p>
                        );
                    })}
                </div>
            );
        }

        // 1. Classic Theme
        const ThemeClassic = ({ data, t, fontStyle }) => {
            const spacing = data.design?.spacing || 1;
            const headerSpacing = data.design?.headerSpacing ?? 1; // Header-to-content gap
            const sectionSpacing = data.design?.sectionSpacing ?? 1; // Section-to-section gap
            const page2Start = data.design?.page2Start; // Section to start on page 2
            const s = (rem) => ({ marginBottom: `${rem * spacing}rem` });
            const gap = (rem) => ({ display: 'flex', flexDirection: 'column', gap: `${rem * spacing}rem` });
            const pageBreak = (section) => page2Start === section ? { breakBefore: 'page' } : {};

            return (
                <div className="h-full w-full p-[15mm] print:p-0 text-slate-900 relative" style={{ fontFamily: fontStyle }}>
                    {/* Header: Flex Row (Left: Info, Right: Avatar) */}
                    <div className="border-b-2 border-gray-800 flex justify-between items-start gap-8" style={{ paddingBottom: `${1.5 * headerSpacing}rem`, marginBottom: `${1.5 * headerSpacing}rem` }}>
                        <div className="flex-1">
                            <h1 className="text-4xl font-bold uppercase tracking-wider mb-2" style={{ color: data.design?.color }}>{data.personal.fullName}</h1>
                            <p className="text-xl text-gray-600 font-medium mb-4">{data.personal.role}</p>

                            {/* Primary Contact Info */}
                            <div className="flex flex-wrap gap-x-6 gap-y-1 text-sm text-gray-500 mb-1">
                                {data.personal.email && <span className="flex items-center gap-1"><MailIcon className="w-3 h-3" style={{ color: data.design?.color }} /> {data.personal.email}</span>}
                                {data.personal.phone && <span className="flex items-center gap-1"><PhoneIcon className="w-3 h-3" style={{ color: data.design?.color }} /> {data.personal.phone}</span>}
                                {data.personal.address && <span className="flex items-center gap-1"><MapPinIcon className="w-3 h-3" style={{ color: data.design?.color }} /> {data.personal.address}</span>}
                            </div>

                            {/* Secondary/Links Info */}
                            {(data.personal.linkedin || data.personal.website) && (
                                <div className="flex flex-wrap gap-x-6 gap-y-1 text-sm text-gray-500">
                                    {data.personal.linkedin && <span className="break-all flex items-center gap-1"><LinkedinIcon className="w-3 h-3" style={{ color: data.design?.color }} /> {data.personal.linkedin}</span>}
                                    {data.personal.website && <span className="break-all flex items-center gap-1"><GlobeIcon className="w-3 h-3" style={{ color: data.design?.color }} /> {data.personal.website}</span>}
                                </div>
                            )}
                        </div>

                        {/* Avatar */}
                        {data.personal.avatar && (
                            <div className="shrink-0">
                                <img src={data.personal.avatar} alt="Profile" className="w-32 h-32 object-cover border border-gray-300 shadow-sm rounded-sm" />
                            </div>
                        )}
                    </div>

                    {/* Summary */}
                    {data.personal.summary && (
                        <div style={{ marginBottom: `${2 * sectionSpacing}rem` }}>
                            <h2 className="text-sm font-bold uppercase tracking-widest border-b border-gray-300 pb-1 mb-3">
                                {t.labels.summary}
                            </h2>
                            <p className="text-sm leading-relaxed text-justify">{data.personal.summary}</p>
                        </div>
                    )}

                    {/* Experience */}
                    {data.experience.length > 0 && (
                        <div style={{ marginBottom: `${2.5 * sectionSpacing}rem`, ...pageBreak('experience') }}>
                            <h2 className="text-sm font-bold uppercase tracking-widest border-b border-gray-300 pb-1" style={s(1)}>
                                {t.experience}
                            </h2>
                            <div style={gap(2)}>
                                {data.experience.map(exp => (
                                    <div key={exp.id} className="print-break-avoid">
                                        <div className="flex justify-between items-baseline mb-1">
                                            <h3 className="font-bold text-base">{exp.role}</h3>
                                            <span className="text-sm font-medium text-gray-600">{exp.date}</span>
                                        </div>
                                        <div className="flex justify-between items-baseline mb-2 text-sm">
                                            <span className="font-semibold italic text-slate-700">{exp.company}</span>
                                            <span className="text-gray-500">{exp.location}</span>
                                        </div>
                                        <TextWithBullets text={exp.description} className="text-sm text-gray-700 leading-snug" />
                                        {exp.technologies && (
                                            <div className="text-xs text-slate-500 mt-2 font-mono">
                                                <span className="font-bold text-slate-700 mr-2">{t.labels.technologies}:</span>
                                                {exp.technologies}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Education */}
                    {data.education.length > 0 && (
                        <div style={{ ...s(3), ...pageBreak('education') }}>
                            <h2 className="text-sm font-bold uppercase tracking-widest border-b border-gray-300 pb-1" style={s(1)}>
                                {t.education}
                            </h2>
                            <div style={gap(2)}>
                                {data.education.map(edu => (
                                    <div key={edu.id} className="print-break-avoid">
                                        <div className="flex justify-between items-baseline mb-1">
                                            <h3 className="font-bold text-base">{edu.school}</h3>
                                            <span className="text-sm font-medium text-gray-600">{edu.date}</span>
                                        </div>
                                        <div className="flex justify-between items-baseline mb-1 text-sm">
                                            <span>{edu.degree}</span>
                                            <span className="text-gray-500">{edu.location}</span>
                                        </div>
                                        {edu.description && <TextWithBullets text={edu.description} className="text-sm text-gray-600 mt-1" />}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Skills & Projects (Combined row if space allows, but stacks for now) */}
                    {data.skills.length > 0 && (
                        <div style={{ ...s(3), ...pageBreak('skills') }}>
                            <h2 className="text-sm font-bold uppercase tracking-widest border-b border-gray-300 pb-1 mb-3">
                                {t.skills}
                            </h2>
                            <div className="text-sm">
                                {data.skills.map(skill => (
                                    skill.name ? (
                                        <div key={skill.id} className="mb-1 flex print-break-avoid">
                                            <span className="font-bold w-32 shrink-0">{skill.name}:</span>
                                            <span>{skill.items}</span>
                                        </div>
                                    ) : null
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Languages */}
                    {data.languages && data.languages.length > 0 && (
                        <div style={{ ...s(3), ...pageBreak('languages') }}>
                            <h2 className="text-sm font-bold uppercase tracking-widest border-b border-gray-300 pb-1 mb-3">
                                {t.languages}
                            </h2>
                            <div className="text-sm flex flex-wrap gap-x-6 gap-y-2">
                                {data.languages.map(lang => (
                                    lang.language ? (
                                        <div key={lang.id} className="print-break-avoid">
                                            <span className="font-bold">{lang.language}:</span> <span className="text-gray-600 ml-1">{lang.proficiency}</span>
                                        </div>
                                    ) : null
                                ))}
                            </div>
                        </div>
                    )}

                    {data.projects.length > 0 && data.design?.showProjects !== false && (
                        <div style={pageBreak('projects')}>
                            <h2 className="text-sm font-bold uppercase tracking-widest border-b border-gray-300 pb-1" style={s(0.75)}>
                                {t.projects}
                            </h2>
                            <div style={gap(1.5)}>
                                {data.projects.map(proj => (
                                    <div key={proj.id} className="text-sm print-break-avoid">
                                        <div className="flex flex-wrap items-baseline gap-2 mb-1">
                                            <span className="font-bold whitespace-nowrap">{proj.name}</span>
                                            {proj.role && <span className="text-gray-500 text-xs whitespace-nowrap">| {proj.role}</span>}
                                            {proj.link && <span className="text-blue-600 text-xs break-all">[{proj.link}]</span>}
                                        </div>
                                        <TextWithBullets text={proj.description} className="text-gray-700 leading-snug" />
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 2. Modern Theme (Sidebar)
        const ThemeModern = ({ data, t, fontStyle }) => {
            const spacing = data.design?.spacing || 1;
            const headerSpacing = data.design?.headerSpacing ?? 1;
            const sectionSpacing = data.design?.sectionSpacing ?? 1;
            const page2Start = data.design?.page2Start;
            const s = (rem) => ({ marginBottom: `${rem * spacing}rem` });
            const gap = (rem) => ({ display: 'flex', flexDirection: 'column', gap: `${rem * spacing}rem` });
            const pageBreak = (section) => page2Start === section ? { breakBefore: 'page' } : {};

            return (
                <div className="flex h-full w-full bg-white relative p-[15mm] print:p-0" style={{ fontFamily: fontStyle }}>
                    {/* Sidebar */}
                    <div className="w-1/3 bg-slate-900 text-white p-8 pt-12 flex flex-col">
                        <div className="text-center" style={s(2.5)}>
                            {/* Avatar or Initials */}
                            <div className="w-32 h-32 mx-auto mb-6 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700 flex items-center justify-center shrink-0">
                                {data.personal.avatar ? (
                                    <img src={data.personal.avatar} alt="Profile" className="w-full h-full object-cover" />
                                ) : (
                                    <span className="text-4xl font-bold text-slate-400">
                                        {data.personal.fullName ? data.personal.fullName.charAt(0).toUpperCase() : 'U'}
                                    </span>
                                )}
                            </div>
                            <h1 className="text-2xl font-bold mb-3 leading-tight break-words">{data.personal.fullName}</h1>
                            <p className="text-sm font-medium uppercase tracking-wide leading-relaxed break-words" style={{ color: data.design?.color || '#93c5fd' }}>{data.personal.role}</p>
                        </div>

                        {/* Contact Info */}
                        <div className="text-sm text-slate-300" style={{ ...s(3), ...gap(1) }}>
                            {data.personal.email && <div className="flex items-center gap-3"><MailIcon className="w-4 h-4 shrink-0" style={{ color: data.design?.color || '#60a5fa' }} /> <span className="break-words w-full">{data.personal.email}</span></div>}
                            {data.personal.phone && <div className="flex items-center gap-3"><PhoneIcon className="w-4 h-4 shrink-0" style={{ color: data.design?.color || '#60a5fa' }} /> <span className="break-all">{data.personal.phone}</span></div>}
                            {data.personal.address && <div className="flex items-start gap-3"><MapPinIcon className="w-4 h-4 shrink-0 mt-0.5" style={{ color: data.design?.color || '#60a5fa' }} /> <span className="break-words leading-snug">{data.personal.address}</span></div>}
                            {data.personal.linkedin && <div className="flex items-start gap-3"><LinkedinIcon className="w-4 h-4 shrink-0 mt-0.5" style={{ color: data.design?.color || '#60a5fa' }} /> <span className="break-all leading-snug">{data.personal.linkedin}</span></div>}
                            {data.personal.website && <div className="flex items-start gap-3"><GlobeIcon className="w-4 h-4 shrink-0 mt-0.5" style={{ color: data.design?.color || '#60a5fa' }} /> <span className="break-all leading-snug">{data.personal.website}</span></div>}
                        </div>

                        {/* Skills */}
                        {data.skills.length > 0 && (
                            <div style={{ marginBottom: `${3 * sectionSpacing}rem`, ...pageBreak('skills') }}>
                                <h3 className="text-xs font-bold uppercase tracking-widest text-slate-500 mb-4 border-b border-slate-700 pb-2">
                                    {t.skills}
                                </h3>
                                <div className="space-y-6">
                                    {data.skills.map(skill => (
                                        skill.name ? (
                                            <div key={skill.id} className="print-break-avoid">
                                                <p className="text-xs font-bold text-white mb-1">{skill.name}</p>
                                                <p className="text-xs text-slate-400 leading-relaxed">{skill.items}</p>
                                            </div>
                                        ) : null
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Languages */}
                        {data.languages && data.languages.length > 0 && (
                            <div style={{ marginBottom: `${2.5 * sectionSpacing}rem`, ...pageBreak('languages') }}>
                                <h3 className="text-xs font-bold uppercase tracking-widest text-slate-500 mb-4 border-b border-slate-700 pb-2">
                                    {t.languages}
                                </h3>
                                <div className="space-y-3">
                                    {data.languages.map(lang => (
                                        <div key={lang.id} className="flex justify-between items-baseline print-break-avoid">
                                            <span className="text-sm font-bold text-white">{lang.language}</span>
                                            <span className="text-xs text-slate-400">{lang.proficiency}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Education (moved to sidebar for Modern look) */}
                        {data.education.length > 0 && (
                            <div style={pageBreak('education')}>
                                <h3 className="text-xs font-bold uppercase tracking-widest text-slate-500 mb-4 border-b border-slate-700 pb-2">
                                    {t.education}
                                </h3>
                                <div className="space-y-4">
                                    {data.education.map(edu => (
                                        <div key={edu.id} className="print-break-avoid">
                                            <p className="text-sm font-bold text-white">{edu.school}</p>
                                            <p className="text-xs mb-1" style={{ color: data.design?.color || '#93c5fd' }}>{edu.degree}</p>
                                            <p className="text-xs text-slate-500 mb-1">{edu.date}</p>
                                            {edu.description && <TextWithBullets text={edu.description} className="text-[10px] text-slate-400 leading-normal opacity-80" />}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Main Content */}
                    <div className="w-2/3 p-8" style={{ paddingTop: `${4 * headerSpacing}rem` }}>
                        {data.personal.summary && (
                            <div style={{ marginBottom: `${3.5 * sectionSpacing}rem`, ...pageBreak('summary') }}>
                                <h2 className="text-lg font-bold text-slate-800 uppercase tracking-widest mb-4 flex items-center gap-2">
                                    <span className="w-8 h-1 block" style={{ backgroundColor: data.design?.color || '#2563eb' }}></span> {t.labels.summary}
                                </h2>
                                <p className="text-sm text-gray-600 leading-7 text-justify">{data.personal.summary}</p>
                            </div>
                        )}

                        {data.experience.length > 0 && (
                            <div style={{ marginBottom: `${3.5 * sectionSpacing}rem`, ...pageBreak('experience') }}>
                                <h2 className="text-lg font-bold text-slate-800 uppercase tracking-widest mb-6 flex items-center gap-2">
                                    <span className="w-8 h-1 block" style={{ backgroundColor: data.design?.color || '#2563eb' }}></span> {t.experience}
                                </h2>
                                <div className="pl-4 border-l-[3px] border-slate-200 ml-2 mt-2" style={gap(3)}>
                                    {data.experience.map(exp => (
                                        <div key={exp.id} className="relative pl-6 print-break-avoid">
                                            {/* Timeline Dot: Calculated to center on the 3px line. Left offset needs to target center of line. */}
                                            {/* Line is at 0px inside Padded container? No, Line matches border-l. */}
                                            {/* We use -left-[27px] approx? Let's check calculations.
                                                Container has pl-4 (16px).
                                                Line is at width 3px.
                                                Item content starts at 16px.
                                                We want dot center at 1.5px (center of line).
                                                16px - 1.5px = 14.5px offset to left?
                                                Dot is w-4 (16px). Center is 8px.
                                                So we want dot left edge at - (14.5 - 8) ? No.
                                                Let's place it absolutely relative to the line.
                                                Actually, simplified:
                                                Put dot overlapping the border.
                                                Container: relative.
                                                Dot: absolute -left-[calc(16px+1.5px-8px)] ?
                                                Standard Tailwind approach: -left-[21px] roughly.
                                            */}
                                            <div className="absolute -left-[23px] top-1.5 w-4 h-4 bg-white border-4 rounded-full box-border z-10" style={{ borderColor: data.design?.color || '#2563eb' }}></div>
                                            <h3 className="text-lg font-bold text-slate-800 break-words">{exp.role}</h3>
                                            <div className="flex justify-between text-sm font-medium mb-3" style={{ color: data.design?.color || '#2563eb' }}>
                                                <span>{exp.company}</span>
                                                <span className="text-slate-400">{exp.date}</span>
                                            </div>
                                            <TextWithBullets text={exp.description} className="text-sm text-gray-600 leading-7" />
                                            {exp.technologies && (
                                                <div className="text-xs text-slate-500 mt-4 font-mono">
                                                    <span className="font-bold mr-2" style={{ color: data.design?.color }}>{t.labels.technologies}:</span>
                                                    {exp.technologies}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {data.projects.length > 0 && data.design?.showProjects !== false && (
                            <div style={pageBreak('projects')}>
                                <h2 className="text-lg font-bold text-slate-800 uppercase tracking-widest mb-6 flex items-center gap-2">
                                    <span className="w-8 h-1 block" style={{ backgroundColor: data.design?.color || '#2563eb' }}></span> {t.projects}
                                </h2>
                                <div className="grid grid-cols-1 gap-6">
                                    {data.projects.map(proj => (
                                        <div key={proj.id} className="bg-slate-50 p-4 rounded-lg print-break-avoid">
                                            <div className="flex justify-between items-center mb-2">
                                                <h4 className="font-bold text-slate-800">{proj.name}</h4>
                                                {proj.link && <span className="text-xs" style={{ color: data.design?.color || '#3b82f6' }}>{proj.link}</span>}
                                            </div>
                                            <TextWithBullets text={proj.description} className="text-sm text-gray-600" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 3. Minimal Theme
        const ThemeMinimal = ({ data, t, fontStyle }) => {
            const spacing = data.design?.spacing || 1;
            const headerSpacing = data.design?.headerSpacing ?? 1;
            const sectionSpacing = data.design?.sectionSpacing ?? 1;
            const page2Start = data.design?.page2Start;
            const s = (rem) => ({ marginBottom: `${rem * spacing}rem` });
            const gap = (rem) => ({ display: 'flex', flexDirection: 'column', gap: `${rem * spacing}rem` });
            const pageBreak = (section) => page2Start === section ? { breakBefore: 'page' } : {};

            return (
                <div className="h-full w-full p-[15mm] print:p-0 text-slate-800 relative" style={{ fontFamily: fontStyle }}>
                    {/* Header */}
                    <div className="flex justify-between items-start" style={{ marginBottom: `${3 * headerSpacing}rem` }}>
                        <div>
                            <h1 className="text-5xl font-light mb-2">{data.personal.fullName}</h1>
                            <p className="text-xl text-gray-500 font-light mb-6">{data.personal.role}</p>
                            <div className="flex flex-wrap text-sm text-gray-400 font-mono gap-x-6">
                                {data.personal.email && <span>{data.personal.email}</span>}
                                {data.personal.phone && <span>{data.personal.phone}</span>}
                                {data.personal.address && <span>{data.personal.address}</span>}
                                {data.personal.linkedin && <span>{data.personal.linkedin}</span>}
                            </div>
                        </div>
                        {/* Minimal Avatar - Full Color, No Grayscale */}
                        {data.personal.avatar && (
                            <div className="w-28 h-28 overflow-hidden rounded-lg shrink-0 border border-gray-100 bg-gray-50">
                                <img src={data.personal.avatar} alt="Profile" className="w-full h-full object-cover" />
                            </div>
                        )}
                    </div>

                    {/* Content Grid */}
                    <div className="grid grid-cols-[1fr_3fr] gap-x-12" style={{ rowGap: `${4 * sectionSpacing}rem` }}>
                        {/* Row 1: Skills (Left) + Experience (Right) */}

                        {/* Left Column */}
                        <div style={gap(3)}>
                            {data.skills.length > 0 && (
                                <div style={pageBreak('skills')}>
                                    <h3 className="text-xs font-bold uppercase tracking-wider mb-4 border-b pb-2" style={{ borderColor: data.design?.color || '#e5e7eb', color: data.design?.color }}>Skills</h3>
                                    <div style={gap(1)}>
                                        {data.skills.map(skill => (
                                            skill.name ? (
                                                <div key={skill.id} className="print-break-avoid">
                                                    <p className="font-bold text-sm mb-1">{skill.name}</p>
                                                    <p className="text-xs text-gray-500 leading-relaxed">{skill.items}</p>
                                                </div>
                                            ) : null
                                        ))}
                                    </div>
                                </div>
                            )}

                            {data.education.length > 0 && (
                                <div style={pageBreak('education')}>
                                    <h3 className="text-xs font-bold uppercase tracking-wider mb-4 border-b pb-2" style={{ borderColor: data.design?.color || '#e5e7eb', color: data.design?.color }}>Education</h3>
                                    <div style={gap(1)}>
                                        {data.education.map(edu => (
                                            edu.school ? (
                                                <div key={edu.id} className="print-break-avoid">
                                                    <p className="font-bold text-sm">{edu.school}</p>
                                                    <p className="text-xs text-gray-500 mb-1">{edu.degree}</p>
                                                    <p className="text-xs text-gray-400 font-mono mb-1">{edu.date}</p>
                                                    {edu.description && <TextWithBullets text={edu.description} className="text-xs text-gray-400 leading-relaxed" />}
                                                </div>
                                            ) : null
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Right Column */}
                        <div style={gap(3)}>
                            {data.personal.summary && (
                                <div style={pageBreak('summary')}>
                                    <p className="text-base leading-relaxed text-gray-600">{data.personal.summary}</p>
                                </div>
                            )}

                            {data.experience.length > 0 && (
                                <div style={pageBreak('experience')}>
                                    <h3 className="text-xs font-bold uppercase tracking-wider mb-6 border-b pb-2" style={{ borderColor: data.design?.color || '#e5e7eb', color: data.design?.color }}>Work Experience</h3>
                                    <div style={gap(2)}>
                                        {data.experience.map(exp => (
                                            <div key={exp.id} className="print-break-avoid">
                                                <div className="flex justify-between items-baseline mb-2">
                                                    <h4 className="font-bold text-lg">{exp.role}</h4>
                                                    <span className="text-sm text-gray-400 font-mono">{exp.date}</span>
                                                </div>
                                                <p className="text-sm font-medium text-gray-500 mb-3">{exp.company}, {exp.location}</p>
                                                <TextWithBullets text={exp.description} className="text-sm text-gray-600 leading-7" />
                                                {exp.technologies && (
                                                    <div className="text-xs text-gray-400 mt-2 font-mono">
                                                        <span className="font-bold mr-2 text-gray-500">{t.labels.technologies}:</span>
                                                        {exp.technologies}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {data.projects.length > 0 && data.design?.showProjects !== false && (
                                <div>
                                    <h3 className="text-xs font-bold uppercase tracking-wider mb-6 border-b pb-2" style={{ borderColor: data.design?.color || '#e5e7eb', color: data.design?.color }}>Selected Projects</h3>
                                    <div style={gap(1.5)}>
                                        {data.projects.map(proj => (
                                            <div key={proj.id} className="print-break-avoid">
                                                <div className="flex items-baseline gap-3 mb-1">
                                                    <h4 className="font-bold text-sm">{proj.name}</h4>
                                                    {proj.link && <span className="text-xs font-mono text-gray-400">{proj.link}</span>}
                                                </div>
                                                <TextWithBullets text={proj.description} className="text-sm text-gray-600" />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 4. Professional Theme (Corporate Standard)
        // Two columns, Left Sidebar (lighter), clean and spacious.
        const ThemeProfessional = ({ data, t, fontStyle }) => {
            const spacing = data.design?.spacing || 1;
            const headerSpacing = data.design?.headerSpacing ?? 1;
            const sectionSpacing = data.design?.sectionSpacing ?? 1;
            const page2Start = data.design?.page2Start;
            const s = (rem) => ({ marginBottom: `${rem * spacing}rem` });
            const gap = (rem) => ({ display: 'flex', flexDirection: 'column', gap: `${rem * spacing}rem` });
            const pageBreak = (section) => page2Start === section ? { breakBefore: 'page' } : {};

            return (
                <div className="h-full w-full flex text-slate-800 relative p-[15mm] print:p-0" style={{ fontFamily: fontStyle }}>
                    {/* Sidebar (Left, 30%) */}
                    <div className="w-[32%] bg-slate-50 border-r border-slate-200 p-8 pt-12 flex flex-col shrink-0">
                        {/* Avatar */}
                        {data.personal.avatar && (
                            <div className="w-32 h-32 mx-auto mb-8 rounded-full overflow-hidden border-4 border-white shadow-md shrink-0">
                                <img src={data.personal.avatar} alt="Profile" className="w-full h-full object-cover" />
                            </div>
                        )}

                        {/* Contact Info */}
                        <div className="text-sm space-y-4" style={s(2.5)}>
                            <h3 className="text-xs font-bold uppercase tracking-widest text-slate-500 mb-4 border-b border-slate-200 pb-2">{t.personalInfo}</h3>
                            {data.personal.email && <div className="flex items-center gap-3"><MailIcon className="w-4 h-4 shrink-0" style={{ color: data.design?.color }} /> <span className="break-all font-medium text-slate-700">{data.personal.email}</span></div>}
                            {data.personal.phone && <div className="flex items-center gap-3"><PhoneIcon className="w-4 h-4 shrink-0" style={{ color: data.design?.color }} /> <span className="font-medium text-slate-700">{data.personal.phone}</span></div>}
                            {data.personal.address && <div className="flex items-start gap-3"><MapPinIcon className="w-4 h-4 shrink-0 mt-0.5" style={{ color: data.design?.color }} /> <span className="break-words leading-snug">{data.personal.address}</span></div>}
                            {data.personal.linkedin && <div className="flex items-center gap-3"><LinkedinIcon className="w-4 h-4 shrink-0" style={{ color: data.design?.color }} /> <span className="break-all" style={{ color: data.design?.color || '#2563eb' }}>{data.personal.linkedin}</span></div>}
                            {data.personal.website && <div className="flex items-center gap-3"><GlobeIcon className="w-4 h-4 shrink-0" style={{ color: data.design?.color }} /> <span className="break-all" style={{ color: data.design?.color || '#2563eb' }}>{data.personal.website}</span></div>}
                        </div>

                        {/* Skills */}
                        {data.skills.length > 0 && (
                            <div style={s(2.5)}>
                                <h3 className="text-xs font-bold uppercase tracking-widest text-slate-500 mb-4 border-b border-slate-200 pb-2">{t.skills}</h3>
                                <div style={gap(1)}>
                                    {data.skills.map(skill => (
                                        skill.name ? (
                                            <div key={skill.id} className="print-break-avoid">
                                                <p className="font-bold text-sm text-slate-700 mb-1">{skill.name}</p>
                                                <p className="text-sm text-slate-500 leading-relaxed">{skill.items}</p>
                                            </div>
                                        ) : null
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Languages */}
                        {data.languages && data.languages.length > 0 && (
                            <div style={s(2.5)}>
                                <h3 className="text-xs font-bold uppercase tracking-widest text-slate-500 mb-4 border-b border-slate-200 pb-2">{t.languages}</h3>
                                <div style={gap(0.75)}>
                                    {data.languages.map(lang => (
                                        lang.language ? (
                                            <div key={lang.id} className="flex justify-between items-baseline print-break-avoid">
                                                <span className="font-bold text-sm text-slate-700">{lang.language}</span>
                                                <span className="text-xs text-slate-500">{lang.proficiency}</span>
                                            </div>
                                        ) : null
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Education (Sidebar in Professional usually works well) */}
                        {data.education.length > 0 && (
                            <div>
                                <h3 className="text-xs font-bold uppercase tracking-widest text-slate-500 mb-4 border-b border-slate-200 pb-2">{t.education}</h3>
                                <div style={gap(1.25)}>
                                    {data.education.map(edu => (
                                        <div key={edu.id} className="print-break-avoid">
                                            <div className="font-bold text-slate-800 text-sm">{edu.school}</div>
                                            <div className="text-xs text-slate-500 font-medium mb-1">{edu.degree}</div>
                                            <div className="text-xs text-slate-400 mb-2">{edu.date}</div>
                                            {edu.description && <TextWithBullets text={edu.description} className="text-xs text-slate-400 leading-snug" />}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Main Content (Right, 70%) */}
                    <div className="flex-1 p-8" style={{ paddingTop: `${4 * headerSpacing}rem` }}>
                        <div className="mb-10 border-b-2 pb-6" style={{ borderColor: data.design?.color || '#1e293b' }}>
                            <h1 className="text-4xl font-extrabold text-slate-900 mb-2 uppercase tracking-tight">{data.personal.fullName}</h1>
                            <p className="text-xl font-medium tracking-wide bg-slate-100 inline-block px-2 rounded-sm" style={{ color: data.design?.color || '#1d4ed8' }}>{data.personal.role}</p>
                        </div>

                        {data.personal.summary && (
                            <div style={{ marginBottom: `${3 * sectionSpacing}rem`, ...pageBreak('summary') }}>
                                <h2 className="text-lg font-bold text-slate-800 uppercase tracking-wider mb-3 flex items-center gap-2">
                                    {t.labels.summary}
                                </h2>
                                <p className="text-slate-600 leading-7 text-justify">{data.personal.summary}</p>
                            </div>
                        )}

                        {data.experience.length > 0 && (
                            <div style={{ marginBottom: `${3 * sectionSpacing}rem`, ...pageBreak('experience') }}>
                                <h2 className="text-lg font-bold text-slate-800 uppercase tracking-wider mb-5 flex items-center gap-2">
                                    <span style={{ color: data.design?.color }}>{t.experience}</span>
                                </h2>
                                <div style={gap(2)}>
                                    {data.experience.map(exp => (
                                        <div key={exp.id} className="print-break-avoid">
                                            <div className="flex justify-between items-baseline mb-1">
                                                <h3 className="text-xl font-bold text-slate-800">{exp.role}</h3>
                                                <span className="text-sm font-bold text-slate-400">{exp.date}</span>
                                            </div>
                                            <div className="flex items-center gap-2 mb-3 text-sm font-medium">
                                                <span style={{ color: data.design?.color || '#1d4ed8' }}>{exp.company}</span>
                                                <span className="text-gray-300">|</span>
                                                <span className="text-gray-500">{exp.location}</span>
                                            </div>
                                            <TextWithBullets text={exp.description} className="text-slate-600 leading-relaxed text-sm pl-1" />
                                            {exp.technologies && (
                                                <div className="text-xs text-slate-500 mt-3 font-mono">
                                                    <span className="font-bold mr-2 text-slate-700">{t.labels.technologies}:</span>
                                                    {exp.technologies}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {data.projects.length > 0 && data.design?.showProjects !== false && (
                            <div style={pageBreak('projects')}>
                                <h2 className="text-lg font-bold text-slate-800 uppercase tracking-wider mb-5 flex items-center gap-2">
                                    <span style={{ color: data.design?.color }}>{t.projects}</span>
                                </h2>
                                <div style={gap(1.5)}>
                                    {data.projects.map(proj => (
                                        <div key={proj.id} className="print-break-avoid">
                                            <div className="flex items-baseline gap-2 mb-1">
                                                <h3 className="font-bold text-slate-800">{proj.name}</h3>
                                                {proj.link && <a href={`https://${proj.link}`} target="_blank" className="text-xs hover:scale-105 transition-transform" style={{ color: data.design?.color || '#2563eb' }}>🔗 {proj.link}</a>}
                                            </div>
                                            <TextWithBullets text={proj.description} className="text-sm text-slate-600 leading-relaxed" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 5. Elegant Theme (Sophisticated, Single Column)
        // Center aligned headers, Serif fonts, very editorial.
        const ThemeElegant = ({ data, t, fontStyle }) => {
            const spacing = data.design?.spacing || 1;
            const headerSpacing = data.design?.headerSpacing ?? 1;
            const sectionSpacing = data.design?.sectionSpacing ?? 1;
            const page2Start = data.design?.page2Start;
            const s = (rem) => ({ marginBottom: `${rem * spacing}rem` });
            const gap = (rem) => ({ display: 'flex', flexDirection: 'column', gap: `${rem * spacing}rem` });
            const pageBreak = (section) => page2Start === section ? { breakBefore: 'page' } : {};

            return (
                <div className="h-full w-full p-[15mm] print:p-0 text-slate-900 relative" style={{ fontFamily: "'Playfair Display', serif" }}>
                    {/* Header - Centered */}
                    <div className="text-center overflow-hidden" style={{ marginBottom: `${2.5 * headerSpacing}rem` }}>
                        {data.personal.avatar && (
                            <div className="w-28 h-28 mx-auto mb-5 rounded-full overflow-hidden border border-gray-200">
                                <img src={data.personal.avatar} alt="Profile" className="w-full h-full object-cover" />
                            </div>
                        )}
                        <h1 className="text-5xl italic font-medium mb-3" style={{ color: data.design?.color }}>{data.personal.fullName}</h1>
                        <p className="text-xs font-sans font-bold tracking-[0.2em] text-gray-500 uppercase mb-6">{data.personal.role}</p>

                        <div className="flex flex-wrap justify-center gap-4 text-sm font-sans text-gray-500 border-t border-b border-gray-100 py-3" style={{ borderColor: data.design?.color ? data.design.color + '40' : undefined }}>
                            {data.personal.email && <span>{data.personal.email}</span>}
                            {data.personal.phone && <span>{data.personal.phone}</span>}
                            {data.personal.address && <span>{data.personal.address}</span>}
                            {data.personal.website && <span>{data.personal.website}</span>}
                        </div>
                    </div>

                    <div className="font-sans">
                        {/* Use Sans for body text to maintain readability */}

                        {/* Summary */}
                        {data.personal.summary && (
                            <div className="text-center max-w-2xl mx-auto" style={{ marginBottom: `${2.5 * sectionSpacing}rem`, ...pageBreak('summary') }}>
                                <p className="text-slate-600 leading-relaxed italic text-lg opacity-80">"{data.personal.summary}"</p>
                            </div>
                        )}

                        {/* Experience */}
                        {data.experience.length > 0 && (
                            <div style={{ marginBottom: `${3.5 * sectionSpacing}rem`, ...pageBreak('experience') }}>
                                <div className="flex items-center gap-4 mb-6">
                                    <div className="h-px bg-gray-200 flex-1" style={{ backgroundColor: data.design?.color ? data.design.color + '40' : undefined }}></div>
                                    <h2 className="text-2xl font-serif italic text-slate-800" style={{ color: data.design?.color }}>{t.experience}</h2>
                                    <div className="h-px bg-gray-200 flex-1" style={{ backgroundColor: data.design?.color ? data.design.color + '40' : undefined }}></div>
                                </div>

                                <div style={gap(2.5)}>
                                    {data.experience.map(exp => (
                                        <div key={exp.id} className="grid grid-cols-[1fr_3fr] gap-6 print-break-avoid">
                                            <div className="text-right pt-1">
                                                <div className="font-bold text-slate-900">{exp.company}</div>
                                                <div className="text-xs text-gray-400 uppercase tracking-widest mt-1">{exp.date}</div>
                                                <div className="text-xs text-gray-400 mt-0.5">{exp.location}</div>
                                            </div>
                                            <div className="border-l border-gray-100 pl-6 relative">
                                                <div className="absolute -left-[3px] top-2 w-1.5 h-1.5 rounded-full bg-slate-300" style={{ backgroundColor: data.design?.color }}></div>
                                                <h3 className="text-lg font-serif italic font-medium mb-2">{exp.role}</h3>
                                                <TextWithBullets text={exp.description} className="text-slate-600 leading-relaxed text-sm" />
                                                {exp.technologies && (
                                                    <div className="text-xs text-slate-500 mt-3 font-mono">
                                                        <span className="font-bold mr-2 text-slate-400">{t.labels.technologies}:</span>
                                                        {exp.technologies}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Education & Skills (Grid) */}
                        <div className="grid grid-cols-2 gap-12 mt-12 border-t border-gray-100 pt-10">
                            <div>
                                {data.education.length > 0 && (
                                    <div style={{ ...s(2), ...pageBreak('education') }}>
                                        <h2 className="text-xl font-serif italic text-center mb-6" style={{ color: data.design?.color }}>{t.education}</h2>
                                        <div style={gap(1.5)}>
                                            {data.education.map(edu => (
                                                <div key={edu.id} className="text-center print-break-avoid">
                                                    <div className="font-bold text-slate-800">{edu.school}</div>
                                                    <div className="text-sm italic text-gray-600">{edu.degree}</div>
                                                    <div className="text-xs text-gray-400 mt-1 mb-2">{edu.date}</div>
                                                    {edu.description && <TextWithBullets text={edu.description} className="text-sm text-gray-500 italic leading-relaxed text-left inline-block" />}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div>
                                {data.skills.length > 0 && (
                                    <div style={s(2.5)}>
                                        <h2 className="text-xl font-serif italic text-center mb-6" style={{ color: data.design?.color }}>{t.skills}</h2>
                                        <div className="text-center" style={gap(1)}>
                                            {data.skills.map(skill => (
                                                skill.name ? (
                                                    <div key={skill.id} className="print-break-avoid">
                                                        <div className="text-xs font-bold uppercase tracking-widest text-gray-400 mb-1">{skill.name}</div>
                                                        <div className="text-sm text-slate-700">{skill.items}</div>
                                                    </div>
                                                ) : null
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {data.languages && data.languages.length > 0 && (
                                    <div>
                                        <h2 className="text-xl font-serif italic text-center mb-6" style={{ color: data.design?.color }}>{t.languages}</h2>
                                        <div className="text-center" style={gap(0.5)}>
                                            {data.languages.map(lang => (
                                                lang.language ? (
                                                    <div key={lang.id} className="mb-3 print-break-avoid">
                                                        <span className="font-bold uppercase tracking-wide text-xs text-slate-500">{lang.language}</span>
                                                        <span className="block text-sm italic text-gray-400 mt-0.5">{lang.proficiency}</span>
                                                    </div>
                                                ) : null
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {data.projects.length > 0 && data.design?.showProjects !== false && (
                            <div className="border-t border-gray-100" style={{ marginTop: `${3 * sectionSpacing}rem`, paddingTop: `${2.5 * sectionSpacing}rem`, borderColor: data.design?.color ? data.design.color + '40' : undefined, ...pageBreak('projects') }}>
                                <h2 className="text-xl font-serif italic text-center mb-6" style={{ color: data.design?.color }}>{t.projects}</h2>
                                <div className="grid grid-cols-1 max-w-3xl mx-auto" style={{ gap: `${1.5 * spacing}rem` }}>
                                    {data.projects.map(proj => (
                                        <div key={proj.id} className="text-center print-break-avoid">
                                            <div className="font-bold text-slate-800 mb-1">
                                                {proj.name}
                                                {proj.link && <span className="font-normal text-gray-400 text-xs ml-2 font-sans tracking-tight">{proj.link}</span>}
                                            </div>
                                            <TextWithBullets text={proj.description} className="text-sm text-slate-600" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="mt-16 text-center">
                            <div className="w-8 h-8 mx-auto border border-gray-300 rounded-full flex items-center justify-center" style={{ borderColor: data.design?.color, color: data.design?.color }}>
                                <span className="text-xs font-serif italic">fin</span>
                            </div>
                        </div>
                    </div>
                </div >
            );
        };

        // --- 主App ---
        const App = () => {
            // Load state from localStorage or use defaults
            const loadState = (key, defaultVal) => {
                try {
                    const saved = localStorage.getItem(key);
                    return saved ? JSON.parse(saved) : defaultVal;
                } catch (e) {
                    console.error("Load failed", e);
                    return defaultVal;
                }
            };

            const [lang, setLang] = useState(() => loadState('resume_lang', 'zh'));
            const [theme, setTheme] = useState(() => loadState('resume_theme', 'classic'));
            const [design, setDesign] = useState(() => loadState('resume_design', { font: 'default', color: '#3b82f6', logo: '', logoPosition: 'header-right', logoSize: 48, logoOpacity: 80, pagedMode: false, showPageNumbers: true, pageNumberPosition: 'bottom-right', spacing: 1 }));
            const [resume, setResume] = useState(() => {
                const data = loadState('resume_data_v1', initialData);
                // Migration: Ensure languages array exists for legacy data
                if (!data.languages) data.languages = [];
                return data;
            });
            const [isSaved, setIsSaved] = useState(true);
            const [activeTab, setActiveTab] = useState('content');

            // Inject design into resume data for easier pass-down (or just pass separate prop)
            // Actually, best to keep separate but for now let's merge or pass as part of theme
            const resumeWithDesign = { ...resume, design };

            // Auto-Save Effects
            useEffect(() => {
                localStorage.setItem('resume_lang', JSON.stringify(lang));
            }, [lang]);

            useEffect(() => {
                localStorage.setItem('resume_theme', JSON.stringify(theme));
            }, [theme]);

            useEffect(() => {
                localStorage.setItem('resume_design', JSON.stringify(design));
            }, [design]);

            useEffect(() => {
                setIsSaved(false);
                const timer = setTimeout(() => {
                    localStorage.setItem('resume_data_v1', JSON.stringify(resume));
                    setIsSaved(true);
                }, 1000); // 1s Debounce
                return () => clearTimeout(timer);
            }, [resume]);

            const t = uiText[lang];

            const A4_HEIGHT_PX = 1123; // Approx 297mm at 96 DPI

            // --- Hooks and Refs ---
            const containerRef = useRef(null);
            const [numPages, setNumPages] = useState(1);

            // Live Pagination Logic
            useLayoutEffect(() => {
                if (!design.pagedMode) {
                    // Reset if disabled
                    if (containerRef.current) {
                        const elements = containerRef.current.querySelectorAll('.print-break-avoid');
                        elements.forEach(el => el.style.marginTop = '0px');
                    }
                    return;
                }

                // Debounce slightly to allow rendering to settle
                const timer = setTimeout(() => {
                    if (!containerRef.current) return;

                    // Reset margins first
                    const items = containerRef.current.querySelectorAll('.print-break-avoid');
                    items.forEach(el => el.style.marginTop = '0px');

                    const containerRect = containerRef.current.getBoundingClientRect();
                    const containerTop = containerRect.top;

                    // Effective page height (A4 - padding if any, but we assume full A4 flow)
                    // We check breaks at 1x, 2x, 3x A4_HEIGHT_PX.

                    items.forEach(el => {
                        const rect = el.getBoundingClientRect();
                        const elTopRelative = rect.top - containerTop;
                        const elHeight = rect.height;
                        const elBottomRelative = elTopRelative + elHeight;

                        const startPage = Math.floor(elTopRelative / A4_HEIGHT_PX);
                        const endPage = Math.floor((elBottomRelative - 1) / A4_HEIGHT_PX);

                        if (startPage !== endPage) {
                            const targetTop = (startPage + 1) * A4_HEIGHT_PX + 20; // Slight padding
                            const pushDown = targetTop - elTopRelative;
                            el.style.marginTop = `${pushDown}px`;
                        }
                    });

                    // Final page count calculation
                    const finalHeight = containerRef.current.scrollHeight;
                    const pages = Math.ceil(finalHeight / A4_HEIGHT_PX);
                    setNumPages(pages || 1);
                }, 50);

                return () => clearTimeout(timer);

            }, [resume, design.pagedMode, theme, design.font, design.logoSize, activeTab]);


            // Handlers
            const handlePersonalChange = (e) => {
                const { name, value } = e.target;
                setResume(prev => ({ ...prev, personal: { ...prev.personal, [name]: value } }));
            };

            const handleAvatarUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) { // 2MB Limit Warning
                        alert(lang === 'zh' ? '图片过大，建议上传小于2MB的图片以保证流畅性。' : 'Image too large. Recommended < 2MB.');
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setResume(prev => ({ ...prev, personal: { ...prev.personal, avatar: reader.result } }));
                    };
                    reader.readAsDataURL(file);
                }
            };

            const removeAvatar = () => {
                setResume(prev => ({ ...prev, personal: { ...prev.personal, avatar: '' } }));
            };

            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 1 * 1024 * 1024) { // 1MB
                        alert(lang === 'zh' ? 'Logo 图片过大，建议小于 1MB。' : 'Logo too large. Recommended < 1MB.');
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setDesign(prev => ({ ...prev, logo: reader.result }));
                    };
                    reader.readAsDataURL(file);
                }
            };

            const removeLogo = () => {
                setDesign(prev => ({ ...prev, logo: '' }));
            };

            const loadExample = () => {
                setResume(lang === 'zh' ? exampleDataZh : exampleDataEn);
            };

            const reset = () => {
                if (confirm(t.reset + "?")) setResume(initialData);
            };

            const printPDF = () => {
                window.print();
            };

            // Generic List Handlers
            const addToList = (listName, emptyItem) => {
                setResume(prev => ({
                    ...prev,
                    [listName]: [...prev[listName], { ...emptyItem, id: Date.now() }]
                }));
            };

            const removeFromList = (listName, id) => {
                setResume(prev => ({
                    ...prev,
                    [listName]: prev[listName].filter(item => item.id !== id)
                }));
            };

            const updateListItem = (listName, id, field, value) => {
                setResume(prev => ({
                    ...prev,
                    [listName]: prev[listName].map(item => item.id === id ? { ...item, [field]: value } : item)
                }));
            };

            const moveListItem = (listName, index, direction) => {
                setResume(prev => {
                    const list = [...prev[listName]];
                    const targetIndex = index + direction;
                    if (targetIndex < 0 || targetIndex >= list.length) return prev;
                    [list[index], list[targetIndex]] = [list[targetIndex], list[index]];
                    return { ...prev, [listName]: list };
                });
            };

            // Font selection based on Lang
            const getFont = () => {
                if (design.font && design.font !== 'default') {
                    if (design.font === 'sans') return "'Inter', sans-serif";
                    if (design.font === 'serif') return "'EB Garamond', serif";
                    if (design.font === 'mono') return "'Fira Code', monospace";
                    if (design.font === 'oswald') return "'Oswald', sans-serif";
                    if (design.font === 'lato') return "'Lato', sans-serif";
                }
                if (theme === 'professional') return "'Roboto', sans-serif";
                if (theme === 'elegant') return "'Playfair Display', serif";
                if (lang === 'zh') return "'Noto Sans SC', sans-serif";
                if (theme === 'classic') return "'EB Garamond', serif";
                if (theme === 'minimal') return "'Inter', sans-serif";
                return "'Roboto', sans-serif"; // modern and default
            };

            const fontStyle = getFont();

            // Spacing Helper
            const s = (baseRem) => ({ marginBottom: `${baseRem * (design.spacing || 1)}rem` });
            const gap = (baseRem) => ({ gap: `${baseRem * (design.spacing || 1)}rem`, display: 'flex', flexDirection: 'column' });

            // Theme Renderer
            const renderTheme = () => {
                const props = { data: resumeWithDesign, t, fontStyle };
                switch (theme) {
                    case 'classic': return <ThemeClassic {...props} />;
                    case 'modern': return <ThemeModern {...props} />;
                    case 'minimal': return <ThemeMinimal {...props} />;
                    case 'professional': return <ThemeProfessional {...props} />;
                    case 'elegant': return <ThemeElegant {...props} />;
                    default: return <ThemeClassic {...props} />;
                }
            };
            return (
                <div className="min-h-screen flex flex-col xl:flex-row bg-gray-50">
                    {/* Left: Editor Sidebar */}
                    <div className="bg-gray-50 border-r border-gray-200 w-full xl:w-[480px] h-auto xl:h-screen xl:sticky xl:top-0 xl:overflow-y-auto shrink-0 print:hidden z-10">
                        <header className="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm">
                            <div className="p-4 flex justify-between items-center border-b border-gray-100">
                                <h1 className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center gap-2">
                                    <FileTextIcon className="text-blue-600" /> {t.title}
                                </h1>
                                <div className="flex gap-2 items-center">
                                    <span className={`text-xs font-medium transition-colors ${isSaved ? 'text-green-500' : 'text-orange-400'}`}>
                                        {isSaved ? (lang === 'zh' ? '已保存' : 'Saved') : (lang === 'zh' ? '保存中...' : 'Saving...')}
                                    </span>
                                    <div className="w-px h-4 bg-gray-300 mx-1"></div>
                                    <button onClick={() => setLang(lang === 'en' ? 'zh' : 'en')} className="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200 text-sm font-medium">
                                        {lang === 'en' ? '中文' : 'EN'}
                                    </button>
                                    <button onClick={loadExample} className="text-blue-600 p-2 hover:bg-blue-50 rounded" title={t.example}>
                                        <Wand2Icon />
                                    </button>
                                    <button onClick={reset} className="text-red-500 p-2 hover:bg-red-50 rounded" title={t.reset}>
                                        <RotateCcwIcon />
                                    </button>
                                </div>
                            </div>
                            {/* Tabs */}
                            <div className="flex">
                                <button
                                    onClick={() => setActiveTab('content')}
                                    className={`flex-1 py-3 text-sm font-bold flex items-center justify-center gap-2 transition-colors ${activeTab === 'content' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-gray-500 hover:bg-gray-50'}`}
                                >
                                    <FileTextIcon className="w-4 h-4" /> {t.contentTab}
                                </button>
                                <button
                                    onClick={() => setActiveTab('design')}
                                    className={`flex-1 py-3 text-sm font-bold flex items-center justify-center gap-2 transition-colors ${activeTab === 'design' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50/50' : 'text-gray-500 hover:bg-gray-50'}`}
                                >
                                    <PaletteIcon className="w-4 h-4" /> {t.designTab}
                                </button>
                            </div>
                        </header>

                        <div className="p-6 space-y-6">
                            {activeTab === 'content' ? (
                                <>
                                    {/* Personal Info */}
                                    <section className="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                                        <h2 className="flex items-center gap-2 text-lg font-bold text-slate-800 mb-4">
                                            <span className="text-blue-600"><UserIcon /></span> {t.personalInfo}
                                        </h2>

                                        {/* Photo Upload */}
                                        <div className="mb-4 flex items-center gap-3">
                                            <div className="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden border border-gray-200 shrink-0">
                                                {resume.personal.avatar ? (
                                                    <img src={resume.personal.avatar} className="w-full h-full object-cover" />
                                                ) : (
                                                    <UserIcon className="text-gray-400" />
                                                )}
                                            </div>
                                            <div className="flex-1">
                                                <label className="cursor-pointer inline-flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-blue-600 rounded-md text-sm font-medium hover:bg-blue-100 transition-colors">
                                                    <UploadIcon className="w-3 h-3" /> {t.uploadPhoto}
                                                    <input type="file" accept="image/*" className="hidden" onChange={handleAvatarUpload} />
                                                </label>
                                                {resume.personal.avatar && (
                                                    <button onClick={removeAvatar} className="ml-2 text-xs text-red-400 hover:text-red-500 underline">
                                                        {t.removePhoto}
                                                    </button>
                                                )}
                                            </div>
                                        </div>

                                        <div className="space-y-3">
                                            <InputGroup label={t.labels.fullName} name="fullName" value={resume.personal.fullName} onChange={handlePersonalChange} />
                                            <InputGroup label={t.labels.role} name="role" value={resume.personal.role} onChange={handlePersonalChange} />
                                            <div className="grid grid-cols-2 gap-3">
                                                <InputGroup label={t.labels.email} name="email" value={resume.personal.email} onChange={handlePersonalChange} />
                                                <InputGroup label={t.labels.phone} name="phone" value={resume.personal.phone} onChange={handlePersonalChange} />
                                            </div>
                                            <InputGroup label={t.labels.address} name="address" value={resume.personal.address} onChange={handlePersonalChange} />
                                            <div className="grid grid-cols-2 gap-3">
                                                <InputGroup label={t.labels.linkedin} name="linkedin" value={resume.personal.linkedin} onChange={handlePersonalChange} />
                                                <InputGroup label={t.labels.website} name="website" value={resume.personal.website} onChange={handlePersonalChange} />
                                            </div>
                                            <InputGroup label={t.labels.summary} name="summary" value={resume.personal.summary} onChange={handlePersonalChange} placeholder={t.placeholders.summary} type="textarea" />
                                        </div>
                                    </section>

                                    {/* Languages (Moved here) */}
                                    <div className="mb-6"></div>
                                    <DynamicList
                                        title={t.languages}
                                        items={resume.languages || []}
                                        icon={GlobeIcon}
                                        t={t}
                                        onAdd={() => addToList('languages', { language: '', proficiency: '' })}
                                        onRemove={(id) => removeFromList('languages', id)}
                                        onChange={(id, field, val) => updateListItem('languages', id, field, val)}
                                        onMove={(idx, dir) => moveListItem('languages', idx, dir)}
                                        fields={[
                                            { key: 'language', labelKey: 'language', type: 'text', options: t.languageOptions },
                                            { key: 'proficiency', labelKey: 'proficiency', type: 'text', options: t.proficiencyOptions }
                                        ]}
                                    />

                                    {/* Experience */}
                                    <DynamicList
                                        title={t.experience}
                                        items={resume.experience}
                                        icon={BriefcaseIcon}
                                        t={t}
                                        onAdd={() => addToList('experience', { role: '', company: '', date: '', location: '', description: '', technologies: '' })}
                                        onRemove={(id) => removeFromList('experience', id)}
                                        onChange={(id, field, val) => updateListItem('experience', id, field, val)}
                                        onMove={(idx, dir) => moveListItem('experience', idx, dir)}
                                        fields={[
                                            { key: 'role', labelKey: 'role' },
                                            { key: 'company', labelKey: 'company' },
                                            { key: 'type', labelKey: 'employmentType', type: 'select', options: t.employmentTypes, placeholderKey: 'employmentType' },
                                            { key: 'date', labelKey: 'date', type: 'text' },
                                            { key: 'location', labelKey: 'location' },
                                            { key: 'technologies', labelKey: 'technologies', placeholderKey: 'technologies', fullWidth: true },
                                            { key: 'description', labelKey: 'description', type: 'textarea', placeholderKey: 'description', fullWidth: true }
                                        ]}
                                    />

                                    {/* Education */}
                                    <DynamicList
                                        title={t.education}
                                        items={resume.education}
                                        icon={GraduationCapIcon}
                                        t={t}
                                        onAdd={() => addToList('education', { degree: '', school: '', date: '', location: '' })}
                                        onRemove={(id) => removeFromList('education', id)}
                                        onChange={(id, field, val) => updateListItem('education', id, field, val)}
                                        onMove={(idx, dir) => moveListItem('education', idx, dir)}
                                        fields={[
                                            { key: 'school', labelKey: 'school' },
                                            { key: 'degree', labelKey: 'degree', type: 'select', options: t.degreeOptions, placeholderKey: 'degree' },
                                            { key: 'date', labelKey: 'date', type: 'text' },
                                            { key: 'location', labelKey: 'location' },
                                            { key: 'description', labelKey: 'description', type: 'textarea', placeholderKey: 'description', fullWidth: true }
                                        ]}
                                    />

                                    {/* Skills */}
                                    <DynamicList
                                        title={t.skills}
                                        items={resume.skills}
                                        icon={RocketIcon}
                                        t={t}
                                        onAdd={() => addToList('skills', { name: '', items: '' })}
                                        onRemove={(id) => removeFromList('skills', id)}
                                        onChange={(id, field, val) => updateListItem('skills', id, field, val)}
                                        onMove={(idx, dir) => moveListItem('skills', idx, dir)}
                                        fields={[
                                            { key: 'name', labelKey: 'name' }, // e.g. "Languages"
                                            { key: 'items', labelKey: 'items' } // e.g. "JS, Python"
                                        ]}
                                    />



                                    {/* Projects */}
                                    <DynamicList
                                        title={t.projects}
                                        items={resume.projects}
                                        icon={LayoutIcon}
                                        t={t}
                                        onAdd={() => addToList('projects', { name: '', description: '', link: '' })}
                                        onRemove={(id) => removeFromList('projects', id)}
                                        onChange={(id, field, val) => updateListItem('projects', id, field, val)}
                                        onMove={(idx, dir) => moveListItem('projects', idx, dir)}
                                        fields={[
                                            { key: 'name', labelKey: 'name' },
                                            { key: 'link', labelKey: 'link' },
                                            { key: 'description', labelKey: 'description', type: 'textarea', fullWidth: true }
                                        ]}
                                    />
                                    <div className="h-10"></div>
                                </>
                            ) : (
                                <div className="space-y-8 animate-fadeIn">

                                    {/* 0. View Mode */}
                                    <section className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-2">
                                                <LayoutIcon className="w-5 h-5 text-blue-600" />
                                                <div className="flex flex-col">
                                                    <span className="font-bold text-slate-800 text-sm">{lang === 'zh' ? '分页预览模式' : 'Paged Preview Mode'}</span>
                                                    <span className="text-[10px] text-slate-500">{lang === 'zh' ? '开启后模拟打印分页效果' : 'Simulates page breaks'}</span>
                                                </div>
                                            </div>
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={design.pagedMode || false}
                                                    onChange={(e) => setDesign(p => ({ ...p, pagedMode: e.target.checked }))}
                                                    className="sr-only peer"
                                                />
                                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>
                                    </section>

                                    {/* 1. Theme Selection */}
                                    <section>
                                        <h3 className="font-bold text-gray-900 mb-4 flex items-center gap-2">
                                            <LayoutIcon className="w-4 h-4 text-blue-500" /> {t.themeLabel}
                                        </h3>
                                        <div className="grid grid-cols-2 gap-3">
                                            {Object.keys(t.themes).map((key) => (
                                                <button
                                                    key={key}
                                                    onClick={() => setTheme(key)}
                                                    className={`px-4 py-3 rounded-lg text-sm font-medium transition-all text-left border ${theme === key ? 'bg-blue-50 border-blue-500 text-blue-700 ring-1 ring-blue-500' : 'bg-white border-gray-200 text-slate-600 hover:border-gray-300 hover:bg-gray-50'}`}
                                                >
                                                    <div className="flex items-center justify-between">
                                                        <span>{t.themes[key]}</span>
                                                        {theme === key && <div className="w-2 h-2 rounded-full bg-blue-500"></div>}
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    </section>

                                    <hr className="border-gray-200" />

                                    {/* 2. Typography */}
                                    <section>
                                        <h3 className="font-bold text-gray-900 mb-4 flex items-center gap-2">
                                            <TypeIcon className="w-4 h-4 text-purple-500" /> {t.fontLabel}
                                        </h3>
                                        <select
                                            value={design.font}
                                            onChange={(e) => setDesign(p => ({ ...p, font: e.target.value }))}
                                            className="w-full p-3 bg-white border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 text-sm font-medium text-slate-700 cursor-pointer"
                                        >
                                            {Object.keys(t.fonts).map(k => (
                                                <option key={k} value={k}>{t.fonts[k]}</option>
                                            ))}
                                        </select>
                                        <p className="mt-2 text-xs text-gray-400">
                                            * {lang === 'zh' ? '部分字体仅对英文生效' : 'Some fonts apply to English text only'}
                                        </p>
                                    </section>

                                    <hr className="border-gray-200" />

                                    {/* 3. Accent Color */}
                                    <section>
                                        <h3 className="font-bold text-gray-900 mb-4 flex items-center gap-2">
                                            <PaletteIcon className="w-4 h-4 text-emerald-500" /> {t.customColor}
                                        </h3>
                                        <div className="flex flex-wrap gap-3">
                                            {['#3b82f6', '#10b981', '#8b5cf6', '#f43f5e', '#f59e0b', '#475569', '#000000'].map(c => (
                                                <button
                                                    key={c}
                                                    onClick={() => setDesign(p => ({ ...p, color: c }))}
                                                    className={`w-8 h-8 rounded-full border border-gray-200 transition-transform hover:scale-110 flex items-center justify-center ${design.color === c ? 'ring-2 ring-offset-2 ring-gray-400' : ''}`}
                                                    style={{ backgroundColor: c }}
                                                >
                                                    {design.color === c && <Icon className="text-white w-4 h-4"><path d="M20 6 9 17l-5-5" /></Icon>}
                                                </button>
                                            ))}
                                            <div className="relative">
                                                <input
                                                    type="color"
                                                    value={design.color}
                                                    onChange={(e) => setDesign(p => ({ ...p, color: e.target.value }))}
                                                    className="w-8 h-8 p-0 border-0 rounded-full overflow-hidden cursor-pointer opacity-0 absolute top-0 left-0 z-10"
                                                />
                                                <div className="w-8 h-8 rounded-full border border-dashed border-gray-400 flex items-center justify-center text-gray-400 bg-gray-50">
                                                    <PlusIcon className="w-4 h-4" />
                                                </div>
                                            </div>
                                        </div>
                                    </section>

                                    <hr className="border-gray-200" />

                                    {/* 4. Logo Branding */}
                                    <section>
                                        <h3 className="font-bold text-gray-900 mb-4 flex items-center gap-2">
                                            <UploadIcon className="w-4 h-4 text-orange-500" /> Logo Branding
                                        </h3>

                                        {!design.logo ? (
                                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 flex flex-col items-center justify-center text-center hover:bg-gray-50 transition-colors relative">
                                                <UploadIcon className="w-8 h-8 text-gray-300 mb-2" />
                                                <span className="text-sm text-blue-600 font-medium">{t.uploadLogo}</span>
                                                <span className="text-xs text-gray-400 mt-1">PNG, JPG, SVG (Max 1MB)</span>
                                                <input type="file" accept="image/*" className="absolute inset-0 opacity-0 cursor-pointer" onChange={handleLogoUpload} />
                                            </div>
                                        ) : (
                                            <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm space-y-4">
                                                <div className="flex items-center gap-4">
                                                    <div className="w-16 h-16 bg-gray-50 rounded-lg border border-gray-100 flex items-center justify-center p-2">
                                                        <img src={design.logo} className="max-w-full max-h-full object-contain" />
                                                    </div>
                                                    <div>
                                                        <button onClick={removeLogo} className="text-sm text-red-500 hover:text-red-700 font-medium flex items-center gap-1">
                                                            <Trash2Icon className="w-3 h-3" /> {t.removeLogo}
                                                        </button>
                                                    </div>
                                                </div>

                                                <div>
                                                    <label className="text-xs font-bold uppercase text-gray-400 block mb-2">{t.logoPosition}</label>
                                                    <div className="grid grid-cols-2 gap-2 mb-4">
                                                        {Object.keys(t.logoPositions).map(k => (
                                                            <button
                                                                key={k}
                                                                onClick={() => setDesign(p => ({ ...p, logoPosition: k }))}
                                                                className={`px-3 py-2 rounded text-xs border bg-white transition-all ${design.logoPosition === k ? 'border-blue-500 text-blue-600 bg-blue-50' : 'border-gray-200 text-gray-600 hover:border-gray-300'}`}
                                                            >
                                                                {t.logoPositions[k]}
                                                            </button>
                                                        ))}
                                                    </div>

                                                    {/* Size Slider */}
                                                    <div className="mb-3">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <label className="text-xs font-bold uppercase text-gray-400">{t.logoSize}</label>
                                                            <span className="text-xs text-gray-500">{design.logoSize || 48}px</span>
                                                        </div>
                                                        <input
                                                            type="range"
                                                            min="20"
                                                            max="200"
                                                            step="4"
                                                            value={design.logoSize || 48}
                                                            onChange={(e) => setDesign(p => ({ ...p, logoSize: parseInt(e.target.value) }))}
                                                            className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                                        />
                                                    </div>

                                                    {/* Opacity Slider */}
                                                    <div>
                                                        <div className="flex justify-between items-center mb-1">
                                                            <label className="text-xs font-bold uppercase text-gray-400">{t.logoOpacity}</label>
                                                            <span className="text-xs text-gray-500">{design.logoOpacity || 80}%</span>
                                                        </div>
                                                        <input
                                                            type="range"
                                                            min="10"
                                                            max="100"
                                                            step="10"
                                                            value={design.logoOpacity || 80}
                                                            onChange={(e) => setDesign(p => ({ ...p, logoOpacity: parseInt(e.target.value) }))}
                                                            className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </section>

                                    <hr className="border-gray-200" />

                                    {/* 5. Paged Preview Mode */}
                                    <section>
                                        <h3 className="font-bold text-gray-900 mb-4 flex items-center gap-2">
                                            <LayoutIcon className="w-4 h-4 text-indigo-500" /> {lang === 'zh' ? '分页预览' : 'Paged Preview'}
                                        </h3>
                                        <div className="flex items-center justify-between mb-3">
                                            <span className="text-sm text-gray-700 font-medium">{lang === 'zh' ? '启用分页预览' : 'Enable Paged View'}</span>
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={design.pagedMode || false}
                                                    onChange={(e) => setDesign(p => ({ ...p, pagedMode: e.target.checked }))}
                                                    className="sr-only peer"
                                                />
                                                <div className="w-10 h-5 bg-gray-200 rounded-full peer peer-checked:bg-blue-600 transition-all after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-5"></div>
                                            </label>
                                        </div>
                                        <p className="text-xs text-gray-400">{lang === 'zh' ? '开启后，内容会自动调整以适应 A4 分页' : 'When enabled, content will auto-adjust for A4 pagination'}</p>
                                    </section>

                                    <hr className="border-gray-200" />

                                    {/* 6. Page Numbers */}
                                    <section>
                                        <h3 className="font-bold text-gray-900 mb-4 flex items-center gap-2">
                                            <span className="text-gray-500">#</span> {lang === 'zh' ? '页码设置' : 'Page Numbers'}
                                        </h3>

                                        <div className="flex items-center justify-between mb-3">
                                            <span className="text-sm text-gray-700 font-medium">{lang === 'zh' ? '显示页码' : 'Show Footer'}</span>
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={design.pageNumbers?.enabled || false}
                                                    onChange={(e) => setDesign(p => ({ ...p, pageNumbers: { ...(p.pageNumbers || {}), enabled: e.target.checked } }))}
                                                    className="sr-only peer"
                                                />
                                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                            </label>
                                        </div>

                                        {design.pageNumbers?.enabled && (
                                            <div className="space-y-3">
                                                <div className="grid grid-cols-3 gap-2">
                                                    {['left', 'center', 'right'].map(pos => (
                                                        <button
                                                            key={pos}
                                                            onClick={() => setDesign(p => ({ ...p, pageNumbers: { ...(p.pageNumbers || {}), position: pos } }))}
                                                            className={`px-3 py-2 rounded text-xs border bg-white transition-all capitalize ${design.pageNumbers?.position === pos ? 'border-blue-500 text-blue-600 bg-blue-50' : 'border-gray-200 text-gray-600 hover:border-gray-300'}`}
                                                        >
                                                            {lang === 'zh' && pos === 'left' ? '左侧' : lang === 'zh' && pos === 'center' ? '中间' : lang === 'zh' ? '右侧' : pos}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </section>

                                    <hr className="border-gray-200" />

                                    {/* Spacing Control */}
                                    <section>
                                        <div className="flex justify-between items-center mb-1">
                                            <h3 className="font-bold text-gray-900 flex items-center gap-2">
                                                <span className="text-gray-500 text-xs">↕</span> {lang === 'zh' ? '全局间距' : 'Layout Spacing'}
                                            </h3>
                                            <span className="text-xs text-gray-500">{Math.round((design.spacing || 1) * 100)}%</span>
                                        </div>
                                        <input
                                            type="range"
                                            min="0.5"
                                            max="2.0"
                                            step="0.1"
                                            value={design.spacing || 1}
                                            onChange={(e) => setDesign(p => ({ ...p, spacing: parseFloat(e.target.value) }))}
                                            className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                        />

                                        {/* Header Spacing (Classic Theme only) */}
                                        <div className="mt-4 flex justify-between items-center mb-1">
                                            <span className="text-sm text-gray-700">{lang === 'zh' ? '头部间距' : 'Header Gap'}</span>
                                            <span className="text-xs text-gray-500">{Math.round((design.headerSpacing ?? 1) * 100)}%</span>
                                        </div>
                                        <input
                                            type="range"
                                            min="0.3"
                                            max="2.0"
                                            step="0.1"
                                            value={design.headerSpacing ?? 1}
                                            onChange={(e) => setDesign(p => ({ ...p, headerSpacing: parseFloat(e.target.value) }))}
                                            className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"
                                        />

                                        {/* Section Spacing (Classic Theme only) */}
                                        <div className="mt-4 flex justify-between items-center mb-1">
                                            <span className="text-sm text-gray-700">{lang === 'zh' ? '板块间距' : 'Section Gap'}</span>
                                            <span className="text-xs text-gray-500">{Math.round((design.sectionSpacing ?? 1) * 100)}%</span>
                                        </div>
                                        <input
                                            type="range"
                                            min="0.3"
                                            max="2.0"
                                            step="0.1"
                                            value={design.sectionSpacing ?? 1}
                                            onChange={(e) => setDesign(p => ({ ...p, sectionSpacing: parseFloat(e.target.value) }))}
                                            className="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"
                                        />
                                    </section>

                                    {/* Page 2 Start Section */}
                                    <section className="mt-4">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm text-gray-700 font-medium">{lang === 'zh' ? '第二页起始板块' : 'Page 2 Start'}</span>
                                        </div>
                                        <select
                                            value={design.page2Start || ''}
                                            onChange={(e) => setDesign(p => ({ ...p, page2Start: e.target.value || undefined }))}
                                            className="w-full p-2 bg-white border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                        >
                                            <option value="">{lang === 'zh' ? '自动分页（默认）' : 'Auto (Default)'}</option>
                                            <option value="experience">{lang === 'zh' ? '工作经历' : 'Experience'}</option>
                                            <option value="education">{lang === 'zh' ? '教育背景' : 'Education'}</option>
                                            <option value="skills">{lang === 'zh' ? '技能' : 'Skills'}</option>
                                            <option value="languages">{lang === 'zh' ? '语言' : 'Languages'}</option>
                                            <option value="projects">{lang === 'zh' ? '项目经历' : 'Projects'}</option>
                                        </select>
                                        <p className="text-xs text-gray-400 mt-1">{lang === 'zh' ? '选中的板块将在第二页开始' : 'Selected section starts on page 2'}</p>
                                    </section>

                                    {/* Projects Visibility Toggle */}
                                    <div className="flex items-center justify-between mb-3 mt-4">
                                        <span className="text-sm text-gray-700 font-medium">{lang === 'zh' ? '显示项目经历' : 'Show Projects'}</span>
                                        <label className="relative inline-flex items-center cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={design.showProjects !== false}
                                                onChange={(e) => setDesign(p => ({ ...p, showProjects: e.target.checked }))}
                                                className="sr-only peer"
                                            />
                                            <div className="w-10 h-5 bg-gray-200 rounded-full peer peer-checked:bg-blue-600 transition-all after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:after:translate-x-5"></div>
                                        </label>
                                    </div>

                                    <div className="h-4"></div>

                                    {/* Print Tips Alert */}
                                    <div className="p-3 bg-amber-50 rounded-lg border border-amber-200 text-xs text-amber-800 space-y-1.5 leading-normal">
                                        <div className="font-bold flex items-center gap-1.5 leading-none mb-1">
                                            <AlertCircleIcon className="w-3.5 h-3.5 shrink-0" />
                                            {lang === 'zh' ? '完美打印建议' : 'Perfect Print Tips'}
                                        </div>
                                        <ul className="list-disc pl-4 space-y-1 opacity-90">
                                            <li>{lang === 'zh' ? '边距：设置为「无」或「最小」' : 'Margins: Set to "None" or "Minimum"'}</li>
                                            <li>{lang === 'zh' ? '页眉和页脚：必须取消勾选' : 'Headers/Footers: MUST be Unchecked'}</li>
                                            <li>{lang === 'zh' ? '缩放：保持 100% (点对点)' : 'Scale: Keep at 100%'}</li>
                                            <li>{lang === 'zh' ? '背景图形：在「更多设置」中勾选' : 'Background Graphics: Check in "More settings"'}</li>
                                        </ul>
                                    </div>

                                    <div className="h-12"></div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Right: Preview Area */}
                    {/* Right: Preview Area */}
                    <div className="bg-gray-200 flex-1 relative print:h-auto print:overflow-visible print:block print:bg-white flex flex-col items-center p-8">

                        {/* Floating Export Button */}
                        <div className="absolute top-6 right-8 z-20 print:hidden">
                            <button onClick={printPDF} className="px-6 py-2.5 rounded-full bg-slate-900 hover:bg-black text-white text-sm font-bold shadow-lg flex items-center gap-2 transition-all hover:scale-105 active:scale-95">
                                <PrinterIcon className="w-4 h-4" /> {t.export}
                            </button>
                        </div>

                        {/* Resume Paper */}
                        <div ref={containerRef} className={`bg-white shadow-2xl w-[210mm] min-h-[297mm] print:shadow-none print:w-[210mm] print:min-h-0 print:mx-auto relative overflow-visible transition-all duration-300 ${design.pagedMode ? 'pb-[200px]' : ''}`}>
                            {/* Logo Overlay - fixed in print, absolute in preview */}
                            {design.logo && (
                                <div className={`absolute z-10 print:fixed print:z-0 pointer-events-none
                                    ${design.logoPosition === 'watermark-center'
                                        ? 'top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 print:top-1/2 print:left-1/2 print:-translate-x-1/2 print:-translate-y-1/2 text-center opacity-30'
                                        : `${(design.logoPosition || 'header-right').startsWith('header') ? 'top-[12mm] print:top-[12mm]' : 'bottom-[12mm] print:bottom-[12mm]'} 
                                           ${(design.logoPosition || 'header-right').endsWith('left') ? 'left-[15mm] print:left-[15mm]' : 'right-[15mm] print:right-[15mm]'}`}`}
                                >
                                    <img
                                        src={design.logo}
                                        alt="Logo"
                                        className="object-contain"
                                        style={{
                                            width: `${design.logoSize || 48}px`,
                                            height: `${design.logoSize || 48}px`,
                                            opacity: (design.logoOpacity || 80) / 100
                                        }}
                                    />
                                </div>
                            )}
                            {renderTheme()}

                            {/* Page Break Guides */}
                            <div className="absolute inset-0 pointer-events-none z-50 print:hidden mix-blend-multiply">
                                <div className="w-full border-b-2 border-dashed border-red-300 opacity-40 absolute top-[297mm] flex justify-end items-end">
                                    <span className="text-[10px] text-red-400 bg-white/80 px-1 rounded font-mono">PAGE 1 END</span>
                                </div>
                                <div className="w-full border-b-2 border-dashed border-red-300 opacity-40 absolute top-[594mm] flex justify-end items-end">
                                    <span className="text-[10px] text-red-400 bg-white/80 px-1 rounded font-mono">PAGE 2 END</span>
                                </div>
                            </div>

                            {/* Page Number Overlay (Custom for Print) */}
                            {design.pageNumbers?.enabled && (
                                <div className="absolute inset-x-0 bottom-0 pointer-events-none z-40">
                                    {/* Page 1 (Approx 280mm) */}
                                    <div className="absolute top-[280mm] w-full px-12 flex" style={{ justifyContent: design.pageNumbers.position === 'center' ? 'center' : design.pageNumbers.position === 'right' ? 'flex-end' : 'flex-start' }}>
                                        <span className="text-xs text-gray-400 font-sans">1</span>
                                    </div>
                                    {/* Page 2 (Approx 577mm) */}
                                    <div className="absolute top-[577mm] w-full px-12 flex" style={{ justifyContent: design.pageNumbers.position === 'center' ? 'center' : design.pageNumbers.position === 'right' ? 'flex-end' : 'flex-start' }}>
                                        <span className="text-xs text-gray-400 font-sans">2</span>
                                    </div>
                                    {/* Page 3 (Approx 874mm) */}
                                    <div className="absolute top-[874mm] w-full px-12 flex" style={{ justifyContent: design.pageNumbers.position === 'center' ? 'center' : design.pageNumbers.position === 'right' ? 'flex-end' : 'flex-start' }}>
                                        <span className="text-xs text-gray-400 font-sans">3</span>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="h-20 print:hidden"></div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <style>
        @media print {
            .print-break-avoid {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    </style>
</body>

</html>